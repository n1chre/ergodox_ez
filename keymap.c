#include QMK_KEYBOARD_H
#include "debug.h"
#include "action_layer.h"

// layers
#define BASE 0
#define SYMBOLS 1
#define NAVIG 2

#define ____________  KC_TRNS

// NOTE: remap these in karabiner to brightness up/down
#define BRIGHT_UP     KC_F19
#define BRIGHT_DOWN   KC_F20

// shortcuts
#define NEXT_APP      LGUI(KC_TAB)
#define PREV_APP      LGUI(LSFT(KC_TAB))
#define CLOSE_WINDOW  LGUI(KC_W)
#define NEXT_TAB      LCTL(KC_TAB)
#define PREV_TAB      LCTL(LSFT(KC_TAB))

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

/* Layer 0: Base layer
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |   L2   |   1  |   2  |   3  |   4  |   5  |Cmd+X |           |Cmd+W |   6  |   7  |   8  |   9  |   0  |MacLock |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |  Del   |   Q  |   W  |   E  |   R  |   T  |Cmd+C |           | Next |   Y  |   U  |   I  |   O  |   P  |Next Tab|
 * |--------+------+------+------+------+------|      |           |  app |------+------+------+------+------+--------|
 * |  Esc   |   A  |   S  |   D  |   F  |   G  |------|           |------|   H  |   J  |   K  |   L  |   ;  |Prev Tab|
 * |--------+------+------+------+------+------|Cmd+V |           | Prev |------+------+------+------+------+--------|
 * |Bspc/Lsh|Z/Ctrl| X/Alt| C/Cmd|   V  |   B  |      |           |  app |   N  |   M  |   ,  |   .  |   /  | RShift |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |  ~L2 |   `  |   '  |   [  |   ]  |                                       |  ~L2 | Left | Down |  Up  | Right|
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        | Prev | Next |       | Mute |Play/Pau|
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |Brigh+|       | Vol+ |        |      |
 *                                 |Space/| Tab  |------|       |------|  Enter |Space/|
 *                                 | CMD  |      |Brigh-|       | Vol- |        | ~L1  |
 *                                 `--------------------'       `----------------------'
 */
[BASE] = LAYOUT_ergodox(
      // left hand
      TG(NAVIG),    KC_1,         KC_2,         KC_3,         KC_4,         KC_5,         LGUI(KC_X),
      KC_DELETE,    KC_Q,         KC_W,         KC_E,         KC_R,         KC_T,         LGUI(KC_C),
      KC_ESC,       KC_A,         KC_S,         KC_D,         KC_F,         KC_G,
      SFT_T(KC_BSPC),CTL_T(KC_Z), ALT_T(KC_X),  GUI_T(KC_C),  KC_V,         KC_B,         LGUI(KC_V),
      MO(NAVIG),    KC_GRAVE,     KC_QUOTE,     KC_LBRACKET,  KC_RBRACKET,

                                                KC_MRWD,      KC_MFFD,
                                                              BRIGHT_UP,
                                  GUI_T(KC_SPC),KC_TAB,       BRIGHT_DOWN,

      // right hand
      CLOSE_WINDOW, KC_6,         KC_7,         KC_8,         KC_9,         KC_0,         LCTL(LSFT(KC_POWER)),
      NEXT_APP,     KC_Y,         KC_U,         KC_I,         KC_O,         KC_P,         NEXT_TAB,
                    KC_H,         KC_J,         KC_K,         KC_L,         KC_SCOLON,    PREV_TAB,
      PREV_APP,     KC_N,         KC_M,         KC_COMMA,     KC_DOT,       KC_SLASH,     KC_RSHIFT,
                                  MO(NAVIG),    KC_LEFT,      KC_DOWN,      KC_UP,        KC_RIGHT,

                                  // KC__ only works on macOS
                                  KC__MUTE,     KC_MPLY,
                                  KC__VOLUP,
                                  KC__VOLDOWN,  KC_ENTER,     LT(SYMBOLS,KC_SPACE)
),

/* Layer 1: Symbols layer TODO fix
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |  F16 |  F17 |  F18 |  F19 |  F20 |  F21   |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |   _  |   +  |   [  |   ]  |   |  |  ~   |           |      |  F6  |  F7  |  F8  |  F9  |  F10 |  F22   |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |   -  |   =  |   (  |   )  |   \  |------|           |------|  F1  |  F2  |  F3  |  F4  |  F5  |  F23   |
 * |--------+------+------+------+------+------|  `   |           |      |------+------+------+------+------+--------|
 * |        |      |      |   {  |   }  |      |      |           |      |  F11 |  F12 |  F13 |  F14 |  F15 |  F24   |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,-------------.
 *                                        |      |      |       |      |      |
 *                                 ,------|------|------|       |------+------+------.
 *                                 |      |      |      |       |      |      |      |
 *                                 |      |      |------|       |------|      |      |
 *                                 |      |      |      |       |      |      |      |
 *                                 `--------------------'       `--------------------'
 */
[SYMBOLS] = LAYOUT_ergodox(
  // left hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, KC_UNDERSCORE,KC_PLUS,      KC_LBRC,      KC_RBRC,      KC_PIPE,      KC_TILDE,
  ____________, KC_MINUS,     KC_EQUAL,     KC_LPRN,      KC_RPRN,      KC_BSLASH,
  ____________, ____________, ____________, KC_LCBR,      KC_RCBR,      ____________, KC_GRAVE,
  ____________, ____________, ____________, ____________, ____________,

                                            ____________, ____________,
                                                          ____________,
                              ____________, ____________, ____________,

  // right hand
  ____________, KC_F16,       KC_F17,       KC_F18,       KC_F19,       KC_F20,       KC_F21,
  ____________, KC_F6,        KC_F7,        KC_F8,        KC_F9,        KC_F10,       KC_F22,
                KC_F1,        KC_F2,        KC_F3,        KC_F4,        KC_F5,        KC_F23,
  ____________, KC_F11,       KC_F12,       KC_F13,       KC_F14,       KC_F15,       KC_F24,
                              ____________, ____________, ____________, ____________, ____________,

                              ____________, ____________,
                              ____________,
                              ____________, ____________, ____________
),

/* Layer 2: Navigation
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * | Accel2 |      |      | MsUp |      |      |      |           |      |      | PgUp |  Up  | Home |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * | Accel1 |      |MsLeft|MsDown|MsRght|      |------|           |------|      | Left | Down | Right|      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * | Accel0 |      |      |      |      |      |      |           |      |      |PgDwn |      | End  |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,-------------.
 *                                        |MdlClk|      |       |      |      |
 *                                 ,------|------|------|       |------+------+------.
 *                                 | Left | Right|      |       |      |      |      |
 *                                 | Click| Click|------|       |------| Esc  | Enter|
 *                                 |      |      |      |       |      |      |      |
 *                                 `--------------------'       `--------------------'
 */
[NAVIG] = LAYOUT_ergodox(
  // left hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  KC_MS_ACCEL2, ____________, ____________, KC_MS_UP,     ____________, ____________, ____________,
  KC_MS_ACCEL1, ____________, KC_MS_LEFT,   KC_MS_DOWN,   KC_MS_RIGHT,  ____________,
  KC_MS_ACCEL0, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________,

                                            KC_MS_BTN3,   ____________,
                                                          ____________,
                              KC_MS_BTN1,   KC_MS_BTN2,   ____________,

  // right hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, KC_PGUP,      KC_UP,        KC_HOME,      ____________, ____________,
                ____________, KC_LEFT,      KC_DOWN,      KC_RIGHT,     ____________, ____________,
  ____________, ____________, KC_PGDOWN,    ____________, KC_END,       ____________, ____________,
                              ____________, ____________, ____________, ____________, ____________,

                              ____________, ____________,
                              ____________,
                              ____________, KC_ESCAPE,    KC_ENTER
),
};

// Runs just one time when the keyboard initializes.
void matrix_init_user(void) {
};

// Runs constantly in the background, in a loop.
void matrix_scan_user(void) {

  uint8_t layer = biton32(layer_state);

  ergodox_board_led_off();
  ergodox_right_led_1_off();
  ergodox_right_led_2_off();
  ergodox_right_led_3_off();
  switch (layer) {
    case SYMBOLS:
      ergodox_right_led_1_on();
      break;
    case NAVIG:
      ergodox_right_led_2_on();
      break;
    default:
      // none
      break;
  }

};
