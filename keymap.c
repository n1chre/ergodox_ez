#include QMK_KEYBOARD_H
#include "action_layer.h"

// layers
#define L_BASE 0 // base
#define L_SYMB 1 // symbols
#define L_NAVI 2 // navigation
#define L_SHOR 3 // shortcuts (spectacle, ...)
#define L_FUNC 4 // function keys and macros (TODO add macros)

#define ____________  KC_TRNS

// NOTE: remap these in karabiner to brightness up/down
#define BRIGHT_UP     KC_F19
#define BRIGHT_DOWN   KC_F20

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

/* Layer 0: Base layer
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |   L2   |   1  |   2  |   3  |   4  |   5  |Cmd+X |           |Cmd+W |   6  |   7  |   8  |   9  |   0  |  TODO  |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |  Tab   |   Q  |   W  |   E  |   R  |   T  |Cmd+C |           | ~L3  |   Y  |   U  |   I  |   O  |   P  | Sft+Tab|
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |Esc/Ctrl|   A  |   S  |   D  |   F  |   G  |------|           |------|   H  |   J  |   K  |   L  |   ;  |  Tab   |
 * |--------+------+------+------+------+------|Cmd+V |           | ~L4  |------+------+------+------+------+--------|
 * | Del/Lsh|   Z  |   X  |   C  |   V  |   B  |      |           |      |   N  |   M  |   ,  |   .  |   /  | RShift |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |  ~L2 |'/Ctrl| `/Alt| [/Cmd|   ]  |                                       |  ~L2 | Left | Down |  Up  | Right|
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |Ply/Ps| Mute |       | Prev | Next   |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      | Vol+ |       |Brigh+|        |      |
 *                                 |Bkspc/| Tab/ |------|       |------| Enter/ |Space/|
 *                                 | CMD  | Shft | Vol- |       |Brigh-|  Shft  | ~L1  |
 *                                 `--------------------'       `----------------------'
 */
[L_BASE] = LAYOUT_ergodox(
      // left hand
      TG(L_NAVI),   KC_1,         KC_2,         KC_3,         KC_4,         KC_5,         LGUI(KC_X),
      KC_TAB,       KC_Q,         KC_W,         KC_E,         KC_R,         KC_T,         LGUI(KC_C),
      CTL_T(KC_ESC),KC_A,         KC_S,         KC_D,         KC_F,         KC_G,
      SFT_T(KC_DEL),KC_Z,         KC_X,         KC_C,         KC_V,         KC_B,         LGUI(KC_V),
      MO(L_NAVI),   CTL_T(KC_QUOT),ALT_T(KC_GRV),GUI_T(KC_LBRC),KC_RBRC,

                                                // KC__ only works on macOS
                                                KC_MPLY,      KC__MUTE,
                                                              KC__VOLUP,
                                  GUI_T(KC_BSPC),SFT_T(KC_TAB),KC__VOLDOWN,

      // right hand
      LGUI(KC_W),   KC_6,         KC_7,         KC_8,         KC_9,         KC_0,         KC_NO,
      MO(L_SHOR),   KC_Y,         KC_U,         KC_I,         KC_O,         KC_P,         LSFT(KC_TAB),
                    KC_H,         KC_J,         KC_K,         KC_L,         KC_SCOLON,    KC_TAB,
      MO(L_FUNC),   KC_N,         KC_M,         KC_COMMA,     KC_DOT,       KC_SLASH,     KC_RSHIFT,
                                  MO(L_NAVI),   KC_LEFT,      KC_DOWN,      KC_UP,        KC_RIGHT,

                                  KC_MRWD,      KC_MFFD,
                                  BRIGHT_UP,
                                  BRIGHT_DOWN,  SFT_T(KC_ENT),LT(L_SYMB,KC_SPACE)
),

/* Layer 1: Symbols layer
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |  |   |   [  |   ]  |  ~   |      |           |      |   _  |  "   |  +   |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |  \   |   (  |   )  |  `   |------|           |------|   -  |  '   |  =   |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |   {  |   }  |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,-------------.
 *                                        |      |      |       |      |      |
 *                                 ,------|------|------|       |------+------+------.
 *                                 |      |      |      |       |      |      |      |
 *                                 |      |      |------|       |------|      |      |
 *                                 |      |      |      |       |      |      |      |
 *                                 `--------------------'       `--------------------'
 */
[L_SYMB] = LAYOUT_ergodox(
  // left hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, KC_PIPE,      KC_LBRC,      KC_RBRC,      KC_TILDE,     ____________,
  ____________, ____________, KC_SLASH,     KC_LPRN,      KC_RPRN,      KC_GRAVE,
  ____________, ____________, ____________, KC_LCBR,      KC_RCBR,      ____________, ____________,
  ____________, ____________, ____________, ____________, ____________,

                                            ____________, ____________,
                                                          ____________,
                              ____________, ____________, ____________,

  // right hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, KC_UNDERSCORE,KC_DQUO,      KC_PLUS,      ____________, ____________, ____________,
                KC_MINUS,     KC_QUOTE,     KC_EQUAL,     ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
                              ____________, ____________, ____________, ____________, ____________,

                              ____________, ____________,
                              ____________,
                              ____________, ____________, ____________
),

/* Layer 2: Navigation
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      | MsUp |      |      |      |           |      |      | PgUp |  Up  | Home |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |MsLeft|MsDown|MsRght|      |------|           |------|      | Left | Down | Right|Accel0|        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |PgDwn |      | End  |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,-------------.
 *                                        |MdlClk|      |       |      |      |
 *                                 ,------|------|------|       |------+------+------.
 *                                 | Left | Right|      |       |      |      |      |
 *                                 | Click| Click|------|       |------| Esc  | Enter|
 *                                 |      |      |      |       |      |      |      |
 *                                 `--------------------'       `--------------------'
 */
[L_NAVI] = LAYOUT_ergodox(
  // left hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, KC_MS_UP,     ____________, ____________, ____________,
  ____________, ____________, KC_MS_LEFT,   KC_MS_DOWN,   KC_MS_RIGHT,  ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________,

                                            KC_MS_BTN3,   ____________,
                                                          ____________,
                              KC_MS_BTN1,   KC_MS_BTN2,   ____________,

  // right hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, KC_PGUP,      KC_UP,        KC_HOME,      ____________, ____________,
                ____________, KC_LEFT,      KC_DOWN,      KC_RIGHT,     KC_MS_ACCEL0, ____________,
  ____________, ____________, KC_PGDOWN,    ____________, KC_END,       ____________, ____________,
                              ____________, ____________, ____________, ____________, ____________,

                              ____________, ____________,
                              ____________,
                              ____________, KC_ESCAPE,    KC_ENTER
),

/* Layer 3: Shortcuts
 *
 * Left hand is used for Spectacle window manager (https://www.spectacleapp.com)
 * mapping  ==>  ~/Library/Application\ Support/Spectacle/Shortcuts.json
 * F - full screen
 * U,D,L,R - up, down, left, right (UL = upper left)
 * N - next display
 * P - previsous display
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |MacLock |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |  UL  |  U   |  UR  |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |  L   |  F   |   R  |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |  DL  |  D   |  DR  |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,-------------.
 *                                        |      |      |       |      |      |
 *                                 ,------|------|------|       |------+------+------.
 *                                 |      |      |      |       |      |      |      |
 *                                 |  N   |  P   |------|       |------|      |      |
 *                                 |      |      |      |       |      |      |      |
 *                                 `--------------------'       `--------------------'
 */
[L_SHOR] = LAYOUT_ergodox(
  // left hand
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, MEH(KC_W),    MEH(KC_E),    MEH(KC_R),    ____________, ____________,
  ____________, ____________, MEH(KC_S),    MEH(KC_D),    MEH(KC_F),    ____________,
  ____________, ____________, MEH(KC_X),    MEH(KC_C),    MEH(KC_V),    ____________, ____________,
  ____________, ____________, ____________, ____________, ____________,

                                            ____________, ____________,
                                                          ____________,
                              MEH(KC_G),    MEH(KC_A),    ____________,

  // right hand
  ____________, ____________, ____________, ____________, ____________, ____________, LCTL(LSFT(KC_POWER)),
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
                ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
                              ____________, ____________, ____________, ____________, ____________,

                              ____________, ____________,
                              ____________,
                              ____________, ____________, ____________
),

/* Layer 4: Function keys and macros
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |  F1  |  F2  |  F3  |  F4  |  F5  |      |           |      |  F6  |  F7  |  F8  |  F9  |  F10 |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,-------------.
 *                                        |      |      |       |      |      |
 *                                 ,------|------|------|       |------+------+------.
 *                                 |      |      |      |       |      |      |      |
 *                                 |      |      |------|       |------|      |      |
 *                                 |      |      |      |       |      |      |      |
 *                                 `--------------------'       `--------------------'
 */
[L_FUNC] = LAYOUT_ergodox(
  // left hand
  ____________, KC_F1,        KC_F2,        KC_F3,        KC_F4,        KC_F5,        ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________,

                                            ____________, ____________,
                                                          ____________,
                              ____________, ____________, ____________,

  // right hand
  ____________, KC_F6,        KC_F7,        KC_F8,        KC_F9,        KC_F10,       ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
                ____________, ____________, ____________, ____________, ____________, ____________,
  ____________, ____________, ____________, ____________, ____________, ____________, ____________,
                              ____________, ____________, ____________, ____________, ____________,

                              ____________, ____________,
                              ____________,
                              ____________, ____________, ____________
),
};

// Runs just one time when the keyboard initializes.
void matrix_init_user(void) {
};

// Runs constantly in the background, in a loop.
void matrix_scan_user(void) {

  uint8_t layer = biton32(layer_state);

  ergodox_board_led_off();
  ergodox_right_led_1_off();
  ergodox_right_led_2_off();
  ergodox_right_led_3_off();
  switch (layer) {
    case L_BASE:
      break;
    case L_SYMB:
      ergodox_right_led_1_on();
      break;
    case L_NAVI:
      ergodox_right_led_2_on();
      break;
    case L_SHOR:
      ergodox_right_led_3_on();
      break;
    default:
      break;
  }

};
